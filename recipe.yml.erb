# vim: ft=yaml

resources:
  # Prepare install packages
  - type: command
    script: brew update
  - type: command
    script: brew upgrade
  - type: command
    script: apm upgrade --compatible --no-confirm

  # Homebrew Taps
  <%- homebrew_taps.each do |tap| -%>
  - type: homebrew_tap
    name: <%= tap %>
  <%- end -%>

  # Homebrew packages
  <%- homebrew_packages.each do |package| -%>
  - type: homebrew_package
    name: <%= package %>
  <%- end -%>

  <%- homebrew_packages_with_options.each do |package| -%>
  - type: homebrew_package
    name: <%= package['name'] %>
    options: <%= package['options'] %>
  <%- end -%>

  # Homebrew Cask packages
  <%- homebrew_cask_packages.each do |package| -%>
  - type: homebrew_cask_package
    name: <%= package %>
  <%- end -%>

  # Rbenv
  - type: rbenv_ruby
    version: 2.3.1
    global: true

  # RubyGems
  - type: command
    script: gem update
  - type: command
    script: gem install bundler pit mechanize

  # Atom packages
  <%- atom_packages.each do |package| -%>
  - type: atom_package
    name: <%= package %>
  <%- end -%>
  - type: command
    script: apm upgrade --compatible --no-confirm

  # Go packages
  <%- go_packages.each do |path| -%>
  - type: go_package
    path: <%= path %>
  <%- end -%>

  # Vagrant Plugins
  <%- vagrant_plugins.each do |name| -%>
  - type: vagrant_plugin
    name: <%= name %>
  <%- end -%>

  # Defaults configurations
  - id: autoplay_quicktime_player
    type: defaults
    domain: com.apple.QuickTimePlayerX
    key: MGPlayMovieOnOpen
    value: 1

  - id: autohide_dock
    type: defaults
    domain: com.apple.dock
    key: autohide
    value: 1
    notify:
      - restart_dock

  # Set the Default shell to Zsh
  - type: command
    check_script: "finger -l | grep '/usr/local/bin/zsh'"
    script: sudo chsh -s $(which zsh) <%= ENV['USER'] %>

  # Cleanup packages
  - type: command
    script: brew cleanup
  - type: command
    script: brew cask cleanup
  - type: command
    script: apm clean
  - type: command
    script: gem cleanup

handlers:
  - id: restart_dock
    type: command
    script: killall Dock
